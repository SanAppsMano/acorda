<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Ativar Alertas</title>
</head>
<body>
  <h1>Receber Notificações</h1>
  <button id="enableBtn">Ativar alertas</button>
  <script>
    const publicVapidKey = '<SUA_PUBLIC_VAPID_KEY>'; // Gere via web-push
    async function subscribeUser() {
      if (!('serviceWorker' in navigator) || !('PushManager' in window)) {
        return alert('Push não suportado');
      }
      const reg = await navigator.serviceWorker.register('sw.js');
      const sub = await reg.pushManager.subscribe({
        userVisibleOnly: true,
        applicationServerKey: urlBase64ToUint8Array(publicVapidKey)
      });
      await fetch('/.netlify/functions/saveSub', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify(sub)
      });
      alert('Inscrição realizada!');
    }
    document.getElementById('enableBtn').onclick = subscribeUser;
    function urlBase64ToUint8Array(base64String) {
      const padding = '='.repeat((4-base64String.length%4)%4);
      const raw = window.atob(base64String + padding);
      return Uint8Array.from([...raw].map(c=>c.charCodeAt(0)));
    }
  </script>
</body>
</html>