<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel Monitor</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2rem; }
    a { display: inline-block; margin: 1rem 0; padding: 1rem 2rem; background: #007acc; color: white; text-decoration: none; border-radius: 0.5rem; }
    button { padding: 1rem 2rem; font-size: 1rem; margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>Inscrição via Link</h1>
  <p>Clique no link abaixo em seu celular para ativar notificações:</p>
  <a href="/subscribe.html" target="_blank">Ativar alertas</a>
  <canvas id="qr" style="margin: 1rem auto; width:200px; height:200px;"></canvas>
  <p>Após a inscrição, no monitor você poderá acordar todos os inscritos.</p>
  <button id="wakeBtn">Acorde todos os inscritos</button>

  <script src="./lib/qrcode.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const url = window.location.origin + "/subscribe.html";
      QRCode.toCanvas(document.getElementById("qr"), url, { width: 200 }, err => { if (err) console.error(err); });
      document.getElementById('wakeBtn').addEventListener('click', async () => {
        try {
        const res = await fetch('/.netlify/functions/sendPush', { method: 'POST' });
        const data = await res.json();
        console.log(data);
        if (data.message) {
          alert(data.message);
        } else {
          alert('Notificações enviadas!');
        }
        } catch (err) {
          console.error(err);
          alert('Erro ao enviar notificações');
        }
      });
    });
  </script>
</body>
</html>
