<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel Monitor</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2rem; }
    #qr { width: 256px; height: 256px; margin: 1rem auto; display: block; }
    button { padding: 1rem 2rem; font-size: 1rem; }
  </style>
</head>
<body>
  <h1>QR Code de Inscrição</h1>
  <img id="qr" alt="QR Code de inscrição" />
  <p>Aponte seu celular para este QR e clique em "Ativar alertas".</p>
  <button id="wakeBtn">Acorde todos os inscritos</button>

  <!-- Lib QRCode -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const img = document.getElementById('qr');
      const targetUrl = `${location.origin}/subscribe.html`;
      // Gera o QR
      QRCode.toDataURL(targetUrl, { width: 256, margin: 2 })
        .then(url => img.src = url)
        .catch(err => console.error('Erro ao gerar QR:', err));

      document.getElementById('wakeBtn').addEventListener('click', async () => {
        try {
          const res = await fetch('/.netlify/functions/sendPush', { method: 'POST' });
          const data = await res.json();
          console.log(data);
          alert('Notificações enviadas!');
        } catch (err) {
          console.error(err);
          alert('Erro ao enviar notificações');
        }
      });
    });
  </script>
</body>
</html>
